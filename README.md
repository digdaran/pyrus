# Telegram-–±–æ—Ç —Ä–æ–∑—ã–≥—Ä—ã—à–∞ ¬´–û–ø–ª–∞—Ç–∏ –∏ —É—á–∞—Å—Ç–≤—É–π¬ª

–ë–æ—Ç –Ω–∞ `aiogram 3 + FastAPI + SQLite`, –ø—Ä–∏–Ω–∏–º–∞—é—â–∏–π –æ–ø–ª–∞—Ç—ã —Ç–æ–ª—å–∫–æ –ø–æ –°–ë–ü —á–µ—Ä–µ–∑ T-–ë–∞–Ω–∫ —ç–∫–≤–∞–π—Ä–∏–Ω–≥.

## –§—É–Ω–∫—Ü–∏–∏
- `/start` + —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ç–µ–ª–µ—Ñ–æ–Ω–∞ —á–µ—Ä–µ–∑ `request_contact`.
- –ü–æ–∫—É–ø–∫–∞ –Ω–æ–º–µ—Ä–∫–æ–≤: –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–≤–æ–¥–∏—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ, —Å—É–º–º–∞ —Å—á–∏—Ç–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.
- –°–æ–∑–¥–∞–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–∞ –≤ T-–ë–∞–Ω–∫–µ (`Init`), –ø–æ–ª—É—á–µ–Ω–∏–µ PAYLOAD (`GetQr`) –∏ –æ—Ç–ø—Ä–∞–≤–∫–∞ QR –≤ Telegram (–°–ë–ü ‚Äî –ø—Ä–µ–¥–ø–æ—á—Ç–∏—Ç–µ–ª—å–Ω—ã–π —Å–ø–æ—Å–æ–±), –ø–ª—é—Å —Å—Å—ã–ª–∫–∞ –Ω–∞ –æ–ø–ª–∞—Ç—É –∫–∞—Ä—Ç–æ–π –∫–∞–∫ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç.
- –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –æ–ø–ª–∞—Ç—ã:
  - webhook `POST /tbank/webhook` (–æ—Å–Ω–æ–≤–Ω–æ–π –ø—É—Ç—å),
  - fallback –∫–Ω–æ–ø–∫–æ–π `üîÑ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ–ø–ª–∞—Ç—É` –∏–ª–∏ –∫–æ–º–∞–Ω–¥–æ–π `/check_payment` (`GetState`).
- –ò–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–∞—è —Ñ–∏–Ω–∞–ª–∏–∑–∞—Ü–∏—è: –≤—ã–¥–∞—á–∞ —Å–ª—É—á–∞–π–Ω—ã—Ö —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –Ω–æ–º–µ—Ä–∫–æ–≤ –∏–∑ –¥–∏–∞–ø–∞–∑–æ–Ω–∞ `1..TICKET_MAX`.
- –ê–¥–º–∏–Ω-–∫–æ–º–∞–Ω–¥—ã:
  - `/stats`
  - `/stop_registration`
  - `/resume_registration`
  - `/manual_allocate` ‚Äî —Ä—É—á–Ω–∞—è –≤—ã–¥–∞—á–∞ –ø–æ —Ç–µ–ª–µ—Ñ–æ–Ω—É + –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ, —Å –æ—Ç–º–µ—Ç–∫–æ–π `source_admin_id` –≤ `tickets`.
- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –∞–¥–º–∏–Ω–∞–º –æ –∫—Ä—É–ø–Ω–æ–π –ø–æ–∫—É–ø–∫–µ –ø–æ –ø–æ—Ä–æ–≥–∞–º.

## –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
–°–∫–æ–ø–∏—Ä—É–π—Ç–µ `.env.example` –≤ `.env` –∏ –∑–∞–ø–æ–ª–Ω–∏—Ç–µ:

```bash
cp .env.example .env
```

–û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ:
- `BOT_TOKEN`
- `ADMIN_IDS`
- `PUBLIC_BASE_URL`
- `TBANK_TERMINAL_KEY`
- `TBANK_PASSWORD`
- `DB_PATH`

## –ó–∞–ø—É—Å–∫ –ª–æ–∫–∞–ª—å–Ω–æ
```bash
python -m venv .venv
source .venv/bin/activate
pip install -r requirements.txt
python app.py
```

## –ó–∞–ø—É—Å–∫ –≤ Docker
```bash
docker compose up -d --build
```

SQLite-—Ñ–∞–π–ª —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ `./data/bot.db` —á–µ—Ä–µ–∑ volume.
